# Project Restructure Guide

## Overview

The SAWRON project has been restructured to better separate frontend and backend concerns, making the codebase more organized and maintainable.

## New Project Structure

```
Sawron/
├── backend/                    # Backend server code
│   ├── models/                # Data models
│   ├── routes/                # Express route handlers (legacy)
│   ├── services/              # Business logic services (legacy)
│   ├── src/                   # Main backend source code
│   │   ├── controllers/       # Request controllers
│   │   ├── middleware/        # Express middleware
│   │   ├── models/           # Data models
│   │   ├── routes/           # API route definitions
│   │   ├── services/         # Business logic services
│   │   └── utils/            # Backend utilities
│   └── server.js             # Express server entry point
├── frontend/                  # Frontend client code
│   ├── src/                   # Frontend source code
│   │   ├── components/        # UI components
│   │   ├── core/             # Core application logic
│   │   ├── managers/         # State and behavior managers
│   │   └── utils/            # Frontend utilities
│   ├── styles/               # CSS stylesheets
│   ├── index.html            # Main HTML file
│   └── styles.css            # Main stylesheet
├── tests/                     # Test files
├── uploads/                   # File upload directory
├── data/                      # Database and data files
├── coverage/                  # Test coverage reports (see below)
└── node_modules/              # Dependencies
```

## Changes Made

### 1. Directory Restructuring
- **`public/` → `frontend/`**: Renamed for clarity
- **Backend files moved to `backend/`**: 
  - `server.js` → `backend/server.js`
  - `src/` → `backend/src/`
  - `services/` → `backend/services/`
  - `models/` → `backend/models/`
  - `routes/` → `backend/routes/`

### 2. Updated File References
- **Server.js**: Updated to serve static files from `../frontend/`
- **Package.json**: Updated start scripts to use `backend/server.js`
- **Test files**: Updated all import paths to reflect new structure
- **HTML file**: Fixed JavaScript file references

### 3. Fixed JavaScript Loading Issues
- **MIME Type**: Added proper Content-Type headers for JavaScript files
- **Script References**: Updated `sawronApp.js` → `app.js` in HTML
- **Missing Scripts**: Added `errorUtils.js` to HTML script loading

## Coverage Folder Explanation

The `coverage/` folder contains **test coverage reports** generated by Jest when you run tests with the `--coverage` flag.

### What's in the Coverage Folder:

1. **`index.html`**: Main coverage report page - open this in a browser to view coverage
2. **`lcov.info`**: Coverage data in LCOV format (used by CI/CD tools)
3. **`lcov-report/`**: HTML coverage reports for detailed viewing
4. **Individual folders** (`models/`, `public/`, `routes/`, `services/`): Coverage reports for each directory
5. **CSS/JS files**: Styling and functionality for the HTML reports

### Coverage Report Features:
- **Line Coverage**: Shows which lines of code were executed during tests
- **Branch Coverage**: Shows which code branches (if/else) were tested
- **Function Coverage**: Shows which functions were called during tests
- **Statement Coverage**: Shows which statements were executed

### How to Use:
1. Run tests with coverage: `npm run test:coverage`
2. Open `coverage/index.html` in your browser
3. Click through folders to see detailed coverage for each file
4. Red lines = not covered, green lines = covered

### Coverage Thresholds:
The project is configured with coverage thresholds in `jest.config.js`:
- Statements: 70%
- Branches: 70%
- Functions: 70%
- Lines: 70%

## Fixed JavaScript Errors

### 1. SawronApp Reference Error
- **Problem**: `ReferenceError: Can't find variable: SawronApp`
- **Cause**: HTML was loading `sawronApp.js` but file was renamed to `app.js`
- **Fix**: Updated HTML script reference to `src/core/app.js`

### 2. MIME Type Error
- **Problem**: `Refused to execute script because "X-Content-Type-Options: nosniff"`
- **Cause**: Server not setting proper Content-Type for JavaScript files
- **Fix**: Added MIME type configuration in Express static middleware

### 3. Missing ErrorUtils
- **Problem**: Components trying to use ErrorUtils but script not loaded
- **Fix**: Added `<script src="src/utils/errorUtils.js"></script>` to HTML

### 4. Global Function Errors
- **Problem**: `bulkRetryAll` and `bulkRetryFailed` functions not found
- **Cause**: Functions not properly exposed to global scope
- **Fix**: Functions are properly exposed in `init.js` - should work after other fixes

## Running the Application

### Development
```bash
# Install dependencies
npm install

# Start development server
npm run dev

# Run tests
npm test

# Run tests with coverage
npm run test:coverage
```

### Production
```bash
# Start production server
npm start
```

### Accessing the Application
- **Frontend**: http://localhost:3000
- **API**: http://localhost:3000/api/*

## Benefits of New Structure

1. **Clear Separation**: Frontend and backend code are clearly separated
2. **Better Organization**: Related files are grouped together
3. **Easier Deployment**: Frontend can be deployed separately if needed
4. **Improved Maintainability**: Easier to find and modify specific functionality
5. **Better Testing**: Test files can target specific areas more easily

## Migration Notes

### For Developers:
- Update any hardcoded paths in your IDE or scripts
- Import statements in backend files now use relative paths from `backend/`
- Frontend utilities are now in `frontend/src/utils/`

### For Deployment:
- Update deployment scripts to use `backend/server.js` as entry point
- Ensure static file serving points to `frontend/` directory
- Update any CI/CD configurations with new paths

## Troubleshooting

### If JavaScript files don't load:
1. Check browser console for 404 errors
2. Verify all script tags in `index.html` point to correct files
3. Ensure server is serving static files from correct directory

### If tests fail:
1. Check that all `require()` statements use correct paths
2. Verify mock statements point to correct files
3. Update any hardcoded paths in test files

### If coverage reports are empty:
1. Ensure tests are actually running
2. Check that source files are in expected locations
3. Verify Jest configuration includes correct file patterns