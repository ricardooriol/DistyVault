<!doctype html>
<html lang="en" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DistyVault</title>
    <meta name="description" content="Gather, distill and control your knowledge" />

  <!-- System fonts only (removed Google Fonts to avoid Safari preconnect errors) -->

    <!-- Tailwind Play CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ['ui-sans-serif', 'system-ui', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial'] },
            colors: {
              brand: {
                50: '#eef2ff', 100: '#e0e7ff', 200: '#c7d2fe', 300: '#a5b4fc',
                400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca',
                800: '#3730a3', 900: '#312e81'
              }
            }
          }
        },
        darkMode: 'class'
      }
    </script>

  <!-- Icons -->
  <!-- Theme-aware icons -->
  <link rel="icon" href="styles/logos/logo_no_bg_w.png" media="(prefers-color-scheme: light)" type="image/png" />
  <link rel="icon" href="styles/logos/logo_no_bg_b.png" media="(prefers-color-scheme: dark)" type="image/png" />
  <link rel="apple-touch-icon" href="styles/logos/logo_no_bg_w.png" media="(prefers-color-scheme: light)" />
  <link rel="apple-touch-icon" href="styles/logos/logo_no_bg_b.png" media="(prefers-color-scheme: dark)" />

  <!-- React 18 UMD + Babel Standalone -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Utilities -->
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <!-- Lucide Icons UMD -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <!-- Optional Feather Icons fallback -->
  <script src="https://unpkg.com/feather-icons"></script>

    <style>
      html, body, #root { height: 100%; }
      .glass {
        backdrop-filter: saturate(180%) blur(12px);
        -webkit-backdrop-filter: saturate(180%) blur(12px);
      }
  /* Theme switch: change instantly to avoid mismatched timing */
  .theme-transition * { transition: none; }
  /* Stronger default contrast for form controls */
  input::placeholder { color: #64748b; opacity: 1; }
  .dark input::placeholder { color: #94a3b8; }
  /* Improve range input visibility */
  input[type="range"] { accent-color: #4f46e5; }
  /* Ensure lucide icons inherit color from their parent for strong contrast */
  .dv-icon svg { color: currentColor; stroke: currentColor; }
  .dark .dv-icon svg { color: currentColor; stroke: currentColor; }
    </style>
    <script>
      // Polyfill requestIdleCallback (avoids extension errors in browsers lacking it)
      (function(){
        if (typeof window !== 'undefined') {
          if (!('requestIdleCallback' in window)) {
            window.requestIdleCallback = function(cb, opts){
              const start = Date.now();
              return setTimeout(function(){
                cb({ didTimeout: false, timeRemaining: function(){ return Math.max(0, 50 - (Date.now()-start)); } });
              }, (opts && opts.timeout) || 1);
            };
          }
          if (!('cancelIdleCallback' in window)) {
            window.cancelIdleCallback = function(id){ clearTimeout(id); };
          }
        }
      })();
    </script>
    <script>
      // Theme bootstrap (persisted: system|light|dark)
      (function() {
        try {
          const pref = localStorage.getItem('dv.theme') || 'system';
          const isDark = pref === 'dark' || (pref === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches);
          document.documentElement.classList.toggle('dark', isDark);
          // If using system theme, listen for OS changes and sync automatically
          const mq = window.matchMedia('(prefers-color-scheme: dark)');
          function onChange(){
            try {
              const prefNow = localStorage.getItem('dv.theme') || 'system';
              if (prefNow !== 'system') return;
              const darkNow = mq.matches;
              document.documentElement.classList.toggle('dark', darkNow);
              // Notify any embedded iframes/viewers
              const msg = { type: 'dv-theme', isDark: darkNow };
              document.querySelectorAll('iframe').forEach(fr => { try { fr.contentWindow && fr.contentWindow.postMessage(msg, '*'); } catch {} });
              window.postMessage(msg, '*');
            } catch {}
          }
          if (mq && mq.addEventListener) mq.addEventListener('change', onChange);
          else if (mq && mq.addListener) mq.addListener(onChange);
        } catch {}
      })();
      window.DV = { version: '0.2.0' };
    </script>
  </head>
  <body class="bg-white text-slate-900 dark:bg-slate-900 dark:text-slate-100">
    <div id="root"></div>

    <!-- Core modules -->
    <script type="text/babel" src="src/core/eventBus.js"></script>
    <script type="text/babel" src="src/core/toast.js"></script>
    <script type="text/babel" src="src/core/db.js"></script>
    <script type="text/babel" src="src/core/queue.js"></script>

  <!-- AI -->
  <script type="text/babel" src="src/ai/providers/openai.js"></script>
  <script type="text/babel" src="src/ai/providers/gemini.js"></script>
  <script type="text/babel" src="src/ai/providers/anthropic.js"></script>
  <script type="text/babel" src="src/ai/providers/deepseek.js"></script>
  <script type="text/babel" src="src/ai/providers/grok.js"></script>
    <script type="text/babel" src="src/ai/service.js"></script>

    <!-- Extractors -->
    <script type="text/babel" src="src/extractors/files.js"></script>
    <script type="text/babel" src="src/extractors/url.js"></script>
    <script type="text/babel" src="src/extractors/youtube.js"></script>
  <script type="text/babel" src="src/extractors/index.js"></script>

    <!-- App -->
    <script type="text/babel" src="src/App.jsx"></script>
    <script>
      // Initialize Lucide icons on first load and on DOM changes caused by React
      document.addEventListener('DOMContentLoaded', function(){
        if (window.lucide && window.lucide.createIcons) {
          window.lucide.createIcons();
        }
      });
    </script>
  </body>
  </html>