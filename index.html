<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>DistyVault</title>
        <link rel="icon" type="image/png" href="logos/logo_no_bg.png">
        <link rel="dns-prefetch" href="https://fonts.googleapis.com">
        <link rel="dns-prefetch" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        <!-- TailwindCSS Play CDN for zero-build styling -->
            <script src="https://cdn.tailwindcss.com"></script>
            <script>
                // Tailwind configuration and CSS variables for theming
                tailwind.config = {
                    darkMode: 'class',
                    theme: {
                    extend: {
                        colors: {
                            brand: {
                                DEFAULT: '#6D28D9',
                                foreground: '#FFFFFF',
                            },
                            muted: '#6b7280',
                        },
                        boxShadow: {
                            soft: '0 2px 8px rgba(0,0,0,0.08)',
                        },
                        keyframes: {
                            inScale: { '0%': { opacity: 0, transform: 'scale(0.975)' }, '100%': { opacity: 1, transform: 'scale(1)' } },
                            fadeIn: { '0%': { opacity: 0 }, '100%': { opacity: 1 } },
                            slideInRight: { '0%': { transform: 'translateX(18px)', opacity: 0 }, '100%': { transform: 'translateX(0)', opacity: 1 } },
                            slideUp: { '0%': { transform: 'translateY(14px)', opacity: 0 }, '100%': { transform: 'translateY(0)', opacity: 1 } },
                            pop: { '0%': { transform: 'scale(0.96)', opacity: 0 }, '100%': { transform: 'scale(1)', opacity: 1 } },
                        },
                        animation: {
                            inScale: 'inScale 200ms cubic-bezier(.2,.8,.2,1)',
                            fadeIn: 'fadeIn 200ms cubic-bezier(.2,.8,.2,1)',
                            slideInRight: 'slideInRight 250ms cubic-bezier(.2,.8,.2,1)',
                            slideUp: 'slideUp 240ms cubic-bezier(.2,.8,.2,1)',
                            pop: 'pop 220ms cubic-bezier(.2,.8,.2,1)',
                        }
                    }
                }
            }
        </script>
        <style>
            :root { color-scheme: light dark; }
            html, body { height: 100%; }
            body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
            /* Smooth scrollbar for webkit */
            * { scrollbar-width: thin; }
            ::-webkit-scrollbar { width: 10px; height: 10px; }
            ::-webkit-scrollbar-thumb { background: rgba(100,116,139,.5); border-radius: 8px; }
            ::-webkit-scrollbar-track { background: transparent; }
            /* Menus in <details> with subtle motion */
            details .dv-menu { opacity: 0; transform: scale(0.98) translateY(4px); pointer-events: none; transition: opacity .2s cubic-bezier(.2,.8,.2,1), transform .2s cubic-bezier(.2,.8,.2,1); }
            details[open] .dv-menu { opacity: 1; transform: scale(1) translateY(0); pointer-events: auto; }
            /* Respect reduced motion */
            @media (prefers-reduced-motion: reduce) {
                * { animation: none !important; transition: none !important; }
                details .dv-menu { opacity: 1; transform: none; }
            }
        </style>
</head>

<body>
        <div id="root"></div>

    <!-- Polyfills -->
    <script>
        // requestIdleCallback polyfill (define on window and global scope)
        (function() {
            if (!('requestIdleCallback' in window)) {
                window.requestIdleCallback = function(callback, options) {
                    const start = Date.now();
                    return setTimeout(function() {
                        callback({
                            didTimeout: false,
                            timeRemaining: function() { return Math.max(0, 50 - (Date.now() - start)); }
                        });
                    }, 1);
                };
            }
            if (typeof requestIdleCallback === 'undefined') {
                try { var requestIdleCallback = window.requestIdleCallback.bind(window); } catch (e) {}
            }
            if (!('cancelIdleCallback' in window)) {
                window.cancelIdleCallback = function(id) { clearTimeout(id); };
            }
            if (typeof cancelIdleCallback === 'undefined') {
                try { var cancelIdleCallback = window.cancelIdleCallback.bind(window); } catch (e) {}
            }
        })();
        // Disable legacy UI initialization so we can mount React
        window.DV_DISABLE_LEGACY_UI = true;
    </script>
    
    <!-- Utility Modules (keep only those needed by core logic) -->
    <script src="src/utils/dateUtils.js"></script>
    <script src="src/utils/validationUtils.js"></script>
    <script src="src/utils/errorUtils.js"></script>

    <!-- Core Services required for ApiClient (EventBus, DB, AI) -->
    <script src="src/core/eventBus.js"></script>
    <script src="src/core/database.js"></script>
    <!-- Ensure processors are available before AI modules -->
    <script src="src/processors/numberingProcessor.js"></script>
    <script src="src/ai/aiProvider.js"></script>
    <script src="src/ai/providers/openAI.js"></script>
    <script src="src/ai/providers/anthropic.js"></script>
    <script src="src/ai/providers/google.js"></script>
    <script src="src/ai/providers/ollama.js"></script>
    <script src="src/ai/providers/grok.js"></script>
    <script src="src/ai/providers/deepseek.js"></script>
    <script src="src/ai/aiProviderFactory.js"></script>
    <script src="src/ai/aiSettingsManager.js"></script>
    <script src="src/ai/aiService.js"></script>
    <script src="src/core/apiClient.js"></script>

    <!-- React and Babel (no build tools) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Mount React UI -->
    <script type="text/babel" data-type="module" data-presets="env,react" src="styles/react/App.jsx"></script>
</body>

</html>
